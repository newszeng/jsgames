(() => {
  var ae = Object.defineProperty; var ne = (n, e, t) => e in n ? ae(n, e, { enumerable: !0, configurable: !0, writable: !0, value: t }) : n[e] = t; var B = (n, e, t) => (ne(n, typeof e != "symbol" ? e + "" : e, t), t); var w = class { constructor(e) { if (this.chess = e || (typeof Chess < "u" ? new Chess : null), !this.chess) throw new Error("Chess.js library not loaded"); this.moveHistory = [] } reset() { this.chess.reset(), this.moveHistory = [] } makeMove(e) { let t = this.chess.move(e); return t && this.moveHistory.push(t.san), t } undoMove() { let e = this.chess.undo(); return e && this.moveHistory.pop(), e } canMove() { return !this.chess.game_over() } getTurn() { return this.chess.turn() } getFEN() { return this.chess.fen() } getHistory() { return this.chess.history() } getMoveCount() { return this.moveHistory.length } loadPGN(e) { let t = this.chess.load_pgn(e, { sloppy: !0 }); return t && (this.moveHistory = this.chess.history()), t } validateDrag(e, t) { if (!this.canMove()) return !1; let s = this.getTurn(); return !(s === "w" && t.search(/^b/) !== -1 || s === "b" && t.search(/^w/) !== -1) } }; var M = { NORMAL: "n", EXPERT: "e" }, G = { [M.NORMAL]: "Normal", [M.EXPERT]: "Expert" }, m = { [M.NORMAL]: 6, [M.EXPERT]: 10 }, u = { EXACT: "enm", PIECE_SQUARE: "psm" }, L = { [u.EXACT]: "Exact Notation Matching", [u.PIECE_SQUARE]: "Piece Square Matching" }, F = u.EXACT, j = { DAILY: "Daily", INFINITE: "Inf" }, J = { DAILY: "Chessle", INFINITE: "Chessle Infinite" }, p = { CORRECT: "g", WRONG_POSITION: "y", NOT_IN_ANSWER: "b" }, Y = { g: "\u{1F7E9}", y: "\u{1F7E8}", b: "\u2B1B" }; var E = class { validateGuess(e, t, s = u.EXACT) { if (e.length !== t.length) throw new Error("Guess and answer lengths do not match"); let o = s || u.EXACT, i = o === u.PIECE_SQUARE ? this.transformToPieceSquareFormat(e) : e, a = o === u.PIECE_SQUARE ? this.transformToPieceSquareFormat(t) : t; return this.compareSequences(i, a) } compareSequences(e, t) { let s = {}; for (let i of t) s[i] = (s[i] || 0) + 1; let o = new Array(e.length); for (let i = 0; i < e.length; i++)e[i] === t[i] && (o[i] = p.CORRECT, s[e[i]]--); for (let i = 0; i < e.length; i++)o[i] || (s[e[i]] > 0 ? (o[i] = p.WRONG_POSITION, s[e[i]]--) : o[i] = p.NOT_IN_ANSWER); return o } transformToPieceSquareFormat(e) { if (typeof Chess > "u") throw new Error("Chess.js library not loaded"); let t = new Chess, s = []; for (let o of e) { let i = t.move(o); i && s.push(i.piece + i.from + i.to) } return s } isWinningResult(e) { return e.every(t => t === p.CORRECT) } }; var g = class n { constructor() { this.prevGuesses = [], this.prevResults = [], this.isGameOver = !1, this.currentGuess = [] } addGuess(e, t) { this.prevGuesses.push(e), this.prevResults.push(t) } canGuess() { return !this.isGameOver && this.prevGuesses.length < 6 } isWin() { let e = this.prevResults[this.prevResults.length - 1]; return e && e.every(t => t === "g") } endGame() { this.isGameOver = !0 } reset() { this.prevGuesses = [], this.prevResults = [], this.isGameOver = !1, this.currentGuess = [] } toJSON() { return { prevGuesses: this.prevGuesses, prevResults: this.prevResults, isGameOver: this.isGameOver } } static fromJSON(e) { let t = new n; return e && (t.prevGuesses = e.prevGuesses || [], t.prevResults = e.prevResults || [], t.isGameOver = e.isGameOver || !1), t } }; var T = class n { constructor() { this.tryDistribution = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0 }, this.numWins = 0, this.numPlayed = 0 } recordWin(e) { e >= 1 && e <= 6 && (this.tryDistribution[e]++, this.numWins++) } recordLoss() { this.numPlayed++ } getWinPercentage() { return this.numPlayed === 0 ? 0 : (this.numWins / this.numPlayed * 100).toFixed(1) } getAverageTries() { if (this.numWins === 0) return 0; let e = 0; for (let t = 1; t <= 6; t++)e += t * this.tryDistribution[t]; return (e / this.numWins).toFixed(1) } toJSON() { return { tryDistribution: this.tryDistribution, numWins: this.numWins, numPlayed: this.numPlayed } } static fromJSON(e) { let t = new n; return e && (t.tryDistribution = e.tryDistribution || t.tryDistribution, t.numWins = e.numWins || 0, t.numPlayed = e.numPlayed || 0), t } }; var N = class n { constructor(e) { this.id = e.num || e.chessleNum, this.date = e.date, this.moves = e.moves || [], this.nameNormal = e.name_normal || e.nameNormal, this.nameExpert = e.name_expert || e.nameExpert, this.difficulty = e.difficulty || "e" } getMovesForDifficulty(e) { let t = e === "n" ? 6 : 10; return this.moves.slice(0, t) } getName(e) { return e === "e" ? this.nameExpert : this.nameNormal } toJSON() { return { id: this.id, date: this.date, moves: this.moves, nameNormal: this.nameNormal, nameExpert: this.nameExpert, difficulty: this.difficulty } } static fromJSON(e) { return new n(e) } }; var x = class { constructor(e) { this.gameMode = e, this.gameStateKey = e === "Daily" ? "chessleDailyGameState" : "chessleInfiniteGameState" } saveGameState(e) { let t = this.loadGameStateRaw() || {}; t.prevGuesses = e.prevGuesses, t.prevResults = e.prevResults, t.isGameOver = e.isGameOver, localStorage.setItem(this.gameStateKey, JSON.stringify(t)) } loadGameState() { let e = this.loadGameStateRaw(); return g.fromJSON({ prevGuesses: e?.prevGuesses || [], prevResults: e?.prevResults || [], isGameOver: e?.isGameOver || !1 }) } loadGameStateRaw() { let e = localStorage.getItem(this.gameStateKey); return e ? JSON.parse(e) : null } savePuzzle(e) { let t = this.loadGameStateRaw() || {}; t.ans = e.moves, localStorage.setItem(this.gameStateKey, JSON.stringify(t)) } loadPuzzle() { let e = this.loadGameStateRaw(); return e?.ans ? { moves: e.ans } : null } savePlayerStats(e) { localStorage.setItem("chessleTryDist", JSON.stringify(e.tryDistribution)), localStorage.setItem("chessleNumWin", e.numWins), localStorage.setItem("chessleNumPlayed", e.numPlayed) } loadPlayerStats() { let e = { tryDistribution: JSON.parse(localStorage.getItem("chessleTryDist") || "{}"), numWins: parseInt(localStorage.getItem("chessleNumWin") || "0"), numPlayed: parseInt(localStorage.getItem("chessleNumPlayed") || "0") }; return T.fromJSON(e) } saveSettings(e) { e.difficulty !== void 0 && localStorage.setItem("chessleDifficulty", e.difficulty), e.notationType !== void 0 && e.notationType !== null && localStorage.setItem("chessleNotationType", e.notationType) } loadSettings() { return { difficulty: localStorage.getItem("chessleDifficulty") || "e", notationType: localStorage.getItem("chessleNotationType") || null, userId: this.getUserId(), legacyUserId: localStorage.getItem("chessleLegacyUserId") || null } } getUserId() { let e = localStorage.getItem("userId"); if (e) return e; let t = localStorage.getItem("chessleLegacyUserId"); if (t) return t; let s = crypto.randomUUID && typeof crypto.randomUUID == "function" ? crypto.randomUUID() : this.generate16DigitId(); return localStorage.setItem("userId", s), s } generate16DigitId() { let e = "0123456789abcdef", t = ""; for (let s = 0; s < 36; s++)s === 8 || s === 13 || s === 18 || s === 23 ? t += "-" : s === 14 ? t += "4" : s === 19 ? t += e[(Math.random() * 4 | 0) + 8] : t += e[Math.random() * 16 | 0]; return t } saveDailyData(e) { let t = this.loadGameStateRaw() || {}; t.date = e, localStorage.setItem(this.gameStateKey, JSON.stringify(t)) } loadDailyDate() { return this.loadGameStateRaw()?.date } saveInfiniteProgress(e) { let t = this.loadGameStateRaw() || {}; t.puzzleNum = e, localStorage.setItem(this.gameStateKey, JSON.stringify(t)) } loadInfiniteProgress() { return this.loadGameStateRaw()?.puzzleNum || 1 } clearGameData() { localStorage.removeItem(this.gameStateKey) } save(e, t) { if (["isWin"].includes(e)) { let o = this.loadGameStateRaw() || {}; o[e] = t, localStorage.setItem(this.gameStateKey, JSON.stringify(o)) } else localStorage.setItem(e, typeof t == "string" ? t : JSON.stringify(t)) } load(e, t) { if (["isWin"].includes(e)) return this.loadGameStateRaw()?.[e] ?? t; let o = localStorage.getItem(e); if (o === null) return t; try { return JSON.parse(o) } catch { return o } } exists(e) { if (["isWin"].includes(e)) { let s = this.loadGameStateRaw(); return s && e in s } return localStorage.getItem(e) !== null } }; var f = class { static migrate() { localStorage.getItem(this.MIGRATION_VERSION_KEY) !== "1" && (this.migrateToV1(), localStorage.setItem(this.MIGRATION_VERSION_KEY, this.CURRENT_VERSION.toString())), localStorage.getItem("chessleNotationType") === "null" && localStorage.removeItem("chessleNotationType") } static migrateToV1() { let e = localStorage.getItem("userId") || localStorage.getItem("userIdDaily"), t = localStorage.getItem("notationType") || localStorage.getItem("notationTypeDaily"), s = localStorage.getItem("difficulty") || localStorage.getItem("difficultyDaily"), o = localStorage.getItem("date") || localStorage.getItem("dateDaily"), i = localStorage.getItem("prevGuesses") || localStorage.getItem("prevGuessesDaily"), a = localStorage.getItem("prevResults") || localStorage.getItem("prevResultsDaily"), l = localStorage.getItem("isGameOver") || localStorage.getItem("isGameOverDaily"), r = localStorage.getItem("isWin") || localStorage.getItem("isWinDaily"), d = localStorage.getItem("ans") || localStorage.getItem("ansDaily"); if (localStorage.clear(), e) { localStorage.setItem("chessleLegacyUserId", e); let h = crypto.randomUUID && typeof crypto.randomUUID == "function" ? crypto.randomUUID() : this.generateUUID(); localStorage.setItem("userId", h) } t && localStorage.setItem("chessleNotationType", t), s && localStorage.setItem("chessleDifficulty", s); let c = {}; try { i && (c.prevGuesses = JSON.parse(i)), a && (c.prevResults = JSON.parse(a)), l != null && (c.isGameOver = l === "true" || l === !0), r != null && (c.isWin = r === "true" || r === !0), d && (c.ans = JSON.parse(d)), o && (c.date = o), Object.keys(c).length > 0 && localStorage.setItem("chessleDailyGameState", JSON.stringify(c)) } catch { } } static generateUUID() { let e = "0123456789abcdef", t = ""; for (let s = 0; s < 36; s++)s === 8 || s === 13 || s === 18 || s === 23 ? t += "-" : s === 14 ? t += "4" : s === 19 ? t += e[(Math.random() * 4 | 0) + 8] : t += e[Math.random() * 16 | 0]; return t } }; B(f, "MIGRATION_VERSION_KEY", "chessleStorageVersion"), B(f, "CURRENT_VERSION", 1); var X = location.hostname === "" || location.hostname === "localhost", K = { GET: X ? "http://localhost:9334/" : "https://d1vwq1uqg5c4bn.cloudfront.net/", POST: X ? "http://localhost:9335/" : "https://d2jwxtulzwxhxh.cloudfront.net/" }, O = { PIECE_THEME: "assets/chess-pieces/{piece}.png", STARTING_POSITION: "start" }; var P = class { constructor() { this.endpoints = K } async fetchPuzzle(e = null) { try { let t = e ? `${this.endpoints.GET}?id=${e}` : this.endpoints.GET, s = await fetch(t); if (!s.ok) throw s.status === 500 ? new Error("Server maintenance") : new Error(`HTTP error! status: ${s.status}`); let o = await s.json(); return new N(o) } catch (t) { throw console.error("Failed to fetch puzzle:", t), t } } async submitResult(e) { try { let t = await fetch(this.endpoints.POST, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(e) }); if (!t.ok) { let s = await t.text(); throw new Error(`HTTP error! status: ${t.status}`) } return await t.json() } catch (t) { throw console.error("Failed to submit result:", t), t } } async fetchDailyPuzzle() { return this.fetchPuzzle() } async fetchInfinitePuzzle(e) { return this.fetchPuzzle(e) } }; var C = class { constructor(e, t) { this.containerId = e, this.onMove = t, this.board = null, this.isGameOver = !1, this.maxMoves = null } initialize(e) { this.game = e; let t = { draggable: !0, position: O.STARTING_POSITION, pieceTheme: s => { let o = s[0] + s[1].toLowerCase(); return O.PIECE_THEME.replace("{piece}", o) }, onDragStart: this.onDragStart.bind(this), onDrop: this.onDrop.bind(this), onSnapEnd: this.onSnapEnd.bind(this) }; if (typeof Chessboard > "u") throw new Error("Chessboard.js library not loaded"); this.board = Chessboard(this.containerId, t) } onDragStart(e, t, s, o) { if (this.isGameOver) return !1; let i = this.game.getMoveCount(); return this.maxMoves && i >= this.maxMoves ? !1 : this.game.validateDrag(e, t) } onDrop(e, t) { let s = this.game.makeMove({ from: e, to: t, promotion: "q" }); return s === null ? "snapback" : (this.onMove && this.onMove(s), s) } onSnapEnd() { this.updatePosition() } updatePosition() { this.board && this.board.position(this.game.getFEN()) } flip() { this.board && this.board.flip() } reset() { this.board && this.board.position(O.STARTING_POSITION) } setGameOver(e) { this.isGameOver = e } setMaxMoves(e) { this.maxMoves = e } destroy() { this.board && this.board.destroy() } }; var U = { LIGHT: "bg-dark", BLACK: "text-white bg-secondary", YELLOW: "text-white bg-warning", GREEN: "text-white bg-success" }, q = { g: U.GREEN, y: U.YELLOW, b: U.BLACK }, Q = { g: "\u{1F7E9}", y: "\u{1F7E8}", b: "\u2B1B" }, V = { large: "bold", medium: "bold", small: "normal", petite: "normal", tiny: "normal", teeny: "normal" }, Z = { large: "5rem", medium: "4rem", small: "3rem", petite: "2.5rem", tiny: "2rem", teeny: "1.75rem" }, ee = { large: { 3: "2rem", 4: "1.8rem", 5: "1.4rem", 6: "1.2rem", 7: "1rem" }, medium: { 3: "1.5rem", 4: "1.4rem", 5: "1.15rem", 6: "1rem", 7: "0.85rem" }, small: { 3: "1.4rem", 4: "1.15rem", 5: "0.95rem", 6: "0.85rem", 7: "0.7rem" }, petite: { 3: "1.2rem", 4: "1rem", 5: "0.77rem", 6: "0.725rem", 7: "0.6rem" }, tiny: { 3: "1.05rem", 4: "0.85rem", 5: "0.7rem", 6: "0.6rem", 7: "0.5rem" }, teeny: { 3: "0.9rem", 4: "0.75rem", 5: "0.6rem", 6: "0.52rem", 7: "0.43rem" } }; var y = class {
    constructor(e) { this.size = e } render(e, t, s = null) {
      let o = Z[this.size], i = this.getFontSize(e), a = V[this.size], l = s ? `id="${s}"` : ""; return `
      <div>
        <div class="card ${t} guess-card" 
             style="width: ${o}; height: ${o};">
          <div class="card-body row align-self-center">
            <p class="card-text align-middle align-self-center text-center"
               style="font-size: ${i}; font-weight: ${a};"
               ${l}>${e}</p>
          </div>
        </div>
      </div>
    `} getFontSize(e) { let t = Math.max(Math.min(e.length, 7), 3); return ee[this.size][t] }
  }; var _ = class {
    constructor(e) { this.container = document.getElementById(e) } renderCurrentGuess(e, t) { let s = m[t], o = this.calculateBoxSize(t), i = ""; for (let a = 0; a < s; a++) { a % 2 === 0 && (i += '<div class="move-group">', i += this.createLabel(a, o)); let l = new y(o); i += l.render(e[a] || "", "bg-dark", `guess-${a}`), a % 2 !== 0 && (i += "</div>") } this.container.innerHTML = i } renderPreviousGuess(e, t, s) { let o = this.calculateBoxSize(s), i = '<div class="row justify-content-center align-self-center">'; for (let a = 0; a < e.length; a++) { a % 2 === 0 && (i += '<div class="move-group">', i += this.createLabel(a, o)); let l = new y(o), r = q[t[a]]; i += l.render(e[a], r), a % 2 !== 0 && (i += "</div>") } return i += "</div>", i } calculateBoxSize(e) { let t = window.innerWidth, s = window.innerHeight; return e === "e" ? t > 1200 && s > 1e3 ? "large" : t > 1e3 && s > 800 ? "medium" : t > 760 ? "small" : t > 290 ? "tiny" : "teeny" : t > 770 && s > 800 ? "large" : t > 500 ? "medium" : t > 400 ? "small" : t > 300 ? "petite" : t > 280 ? "tiny" : "teeny" } createLabel(e, t) {
      let s = e / 2 + 1, o = this.getLabelFontSize(t), i = this.getLabelFontWeight(t); return `
      <span class="move-label align-self-center" 
            style="font-size: ${o}; font-weight: ${i};">
        ${s}.
      </span>
    `} getLabelFontSize(e) { return { large: "2rem", medium: "1.5rem", small: "1.4rem", petite: "1.2rem", tiny: "1.05rem", teeny: "0.9rem" }[e] || "1rem" } getLabelFontWeight(e) { return ["large", "medium"].includes(e) ? "bold" : "normal" } hide() { this.container.style.display = "none" } show() { this.container.style.display = "" }
  }; var R = class {
    constructor() { this.activeModal = null } show(e, t = {}) { let s = document.getElementById(e); if (!s) return; let o = $(s); o.modal(t), o.modal("show"), this.activeModal = e } hide(e) { let t = e ? document.getElementById(e) : this.activeModal ? document.getElementById(this.activeModal) : null; t && ($(t).modal("hide"), this.activeModal = null) } showInstructions(e, t) { let s = document.getElementById("instructionsModalTitle"), o = document.getElementById("instructionsModalBody"); s && (s.textContent = `Welcome to ${e}`), o && (o.innerHTML = this.getInstructionsHTML(e)), document.querySelectorAll('[onclick*="chooseMode"]').forEach(a => { let l = a.getAttribute("onclick").match(/'([^']+)'/)[1]; a.onclick = () => { this.hide("instructionsModal"), t(l) } }), this.show("instructionsModal", { backdrop: "static", keyboard: !1 }) } showHelp(e) { let t = document.getElementById("helpModalTitle"), s = document.getElementById("helpModalBody"); t && (t.textContent = "How to Play"), s && (s.innerHTML = this.getInstructionsHTML(e)), this.show("helpModal") } showShareModal(e, t) { let s = document.getElementById("shareModalTitle"), o = document.getElementById("shareModalBody"); s && (s.textContent = e), o && (o.innerHTML = t), this.show("shareModal") } showNotationModal(e, t = !0) { let s = document.getElementById("chooseEnm"), o = document.getElementById("choosePsm"), i = document.querySelector("#notationModal .alert-info"); !t && i && (i.className = "alert alert-danger text-center mb-3", i.style.fontSize = "0.9rem", i.innerHTML = '<i class="fas fa-lock"></i> Your choice is locked after submitting your first guess!<br>You can choose again tomorrow.'), s && (s.onclick = () => { this.hide("notationModal"), e("enm") }), o && (o.onclick = () => { this.hide("notationModal"), e("psm") }), this.show("notationModal") } showMaintenance() { this.show("maintenanceModal", { backdrop: "static", keyboard: !1 }) } showAlert(e, t, s = "danger", o = "before") {
      let i = `alert-${e}-${s}`, a = document.getElementById(e); if (!a) return; let l = document.getElementById(i); l && l.remove(); let r = document.createElement("div"); r.id = i, r.className = `alert alert-${s}`, r.textContent = t, e === "alertArea" && (r.style.cssText = `
        padding: 0.25rem 0.5rem;
        margin: 0.25rem 0;
        font-size: 0.875rem;
        display: inline-block;
        border-radius: 0.25rem;
      `), e === "notationModalAlertArea" && (r.style.cssText = `
        margin-bottom: 1rem;
        text-align: center;
        font-weight: 500;
      `), o === "before" ? a.insertBefore(r, a.firstChild) : a.appendChild(r), setTimeout(() => { r.parentNode && r.remove() }, 2500)
    } getInstructionsHTML(e) {
      let t = `
      Guess the entire opening sequence, for both white and black!<br />
      <div class="instructions-example">
        <p class="instructions-example-title">Example</p>
        <img class="instructions-example-img" src="static/images/example.png">
        <br /><br />
        <img class="instructions-colour" src="static/images/Nf3.png">
        Green on Nf3 means that Nf3 was played on that specific move (White on move 2).
        <br /><br />
        <img class="instructions-colour" src="static/images/d4.png">
        Yellow on d4 means that d4 was indeed played, but not at that specific spot (White on move 1).
        <br /><br />
        <img class="instructions-colour" src="static/images/d5.png">
        Grey on d5 means that d5 was not played by either white or black.
        <br /><br />
        You have 6 guesses. Good luck!
    `, s = e.includes("Infinite") ? `
      <br /><br />
      This is Chessle Infinite! More information to come.
    `: ""; return t + s + "</div>"
    }
  }; var z = class {
    constructor() { this.board = null, this.guessGrid = null, this.modalManager = new R, this.previousGuessesContainer = null } initialize(e) { this.board = new C("myBoard", e.onMove), this.guessGrid = new _("currentGuess"), this.previousGuessesContainer = document.getElementById("prevGuesses"), this.gameCallbacks = e, this.setupEventListeners() } setupEventListeners() { document.addEventListener("keydown", e => { if (!(this.gameCallbacks.isGameOver && this.gameCallbacks.isGameOver())) switch (e.key) { case "Backspace": case "ArrowLeft": this.gameCallbacks.onUndo && this.gameCallbacks.onUndo(); break; case " ": e.preventDefault(), this.gameCallbacks.onFillPrevious && this.gameCallbacks.onFillPrevious(); break; case "ArrowRight": this.gameCallbacks.onRedo && this.gameCallbacks.onRedo(); break; case "x": case "X": this.gameCallbacks.onFlip && this.gameCallbacks.onFlip(); break; case "Enter": e.preventDefault(), this.gameCallbacks.onSubmit && this.gameCallbacks.onSubmit(); break } }) } initializeBoard(e) { this.board.initialize(e) } updateCurrentGuess(e, t) { this.guessGrid.renderCurrentGuess(e, t) } addPreviousGuess(e, t, s) { if (this.previousGuessesContainer) { let o = this.guessGrid.renderPreviousGuess(e, t, s); this.previousGuessesContainer.innerHTML += o } } showAllPreviousGuesses(e, t, s) { if (this.previousGuessesContainer) { this.previousGuessesContainer.innerHTML = ""; for (let o = 0; o < e.length; o++)this.addPreviousGuess(e[o], t[o], s) } } updateBoardPosition() { this.board.updatePosition() } flipBoard() { this.board.flip() } resetBoard() { this.board.reset() } setMaxMoves(e) { this.board.setMaxMoves(e) } hideGameElements() { ["currentGuess", "submit", "undoButton", "flipButton", "fillButton", "chooseNotationButton"].forEach(t => { let s = document.getElementById(t); s && (s.style.display = "none") }), this.board && this.board.setGameOver(!0) } showInstructionsModal(e, t) { this.modalManager.showInstructions(e, t) } showHelpModal(e) { this.modalManager.showHelp(e) } showShareModal(e, t, s, o, i, a = null) {
      let l = a || (e ? "Congrats, you won!" : "Nice try!"), r = this.createEmojiPattern(s), d = this.createPGN(o), c = `
      <p class="share-modal-pattern">${r}</p>
      <p class="share-modal-answer">
        The answer was<br />
        ${d}<br />
        ${i}
      </p>
      <p id="share-modal-stats" class="share-modal-answer"></p>
      <p class="share-modal-answer">
        ${t === "Chessle" ? "<br />Chessle resets at 12am PST every day!" : ""}
      </p>
    `; this.modalManager.showShareModal(l, c)
    } showNotationModal(e, t = !0) { this.modalManager.showNotationModal(e, t) } showMaintenanceModal() { this.modalManager.showMaintenance() } showAlert(e, t = "danger") { this.modalManager.showAlert("errorArea", e, t) } showShareAlert() { this.modalManager.showAlert("alertArea", "Copied \u{1F44D}", "primary", "before") } showNotationModalAlert(e, t = "danger") { this.modalManager.showAlert("notationModalAlertArea", e, t) } hideModal(e) { this.modalManager.hide(e) } updateShareStats(e) { let t = document.getElementById("share-modal-stats"); t && (t.innerHTML = e) } updateNotationBadge(e) { let t = document.getElementById("chooseNotation"); t && (t.innerHTML = e) } showBubble() { let e = document.getElementById("overlay"), t = document.getElementById("bubble"); e && (e.style.display = "block"), t && (t.style.display = "block") } hideBubble() { let e = document.getElementById("overlay"), t = document.getElementById("bubble"); e && (e.style.display = "none"), t && (t.style.display = "none") } disableNotationButtons() { ["chooseEnm", "choosePsm"].forEach(t => { let s = document.getElementById(t); s && (s.disabled = !0, s.classList.remove("btn-primary"), s.classList.add("btn-secondary", "disabled"), s.style.cursor = "not-allowed", s.style.opacity = "0.6") }) } createEmojiPattern(e) { return e.map(t => t.map(s => Q[s]).join("")).join("<br />") } createPGN(e) { let t = ""; for (let s = 0; s < e.length; s++)s % 2 === 0 && (t += `${s / 2 + 1}. `), t += e[s], s !== e.length - 1 && (t += " "); return t }
  }; var D = class {
    createShareText(e, t, s, o, i) {
      let a = o.prevResults[o.prevResults.length - 1], r = a && a.every(c => c === "g") ? o.prevResults.length : "X", d = `${e} ${t} `; return e === "Chessle" && (d += `(${G[s]}) `), d += `${r}/${6}

`, d += this.createEmojiPattern(o.prevResults) + `
`, d += i, d
    } createEmojiPattern(e) {
      return e.map(t => t.map(s => Y[s]).join("")).join(`
`)
    } async shareToClipboard(e, t) { try { this.canUseNativeShare() && navigator.canShare({ text: e }) ? await navigator.share({ text: e }) : (await navigator.clipboard.writeText(e), t && t()) } catch (s) { console.error("Failed to share:", s); try { await navigator.clipboard.writeText(e), t && t() } catch (o) { console.error("Failed to copy to clipboard:", o) } } } canUseNativeShare() { let e = navigator.userAgent || navigator.vendor || window.opera, t = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e.toLowerCase()), s = e.toLowerCase().includes("firefox"); return t && !s && "share" in navigator }
  }; var A = class { constructor(e) { this.mode = e, this.game = new w, this.validator = new E, this.storage = new x(e.getStorageSuffix()), this.api = new P, this.ui = new z, this.shareService = new D, this.gameState = new g, this.puzzle = null, this.settings = null, this.curGuessStack = [] } async initialize() { try { f.migrate(), this.settings = this.storage.loadSettings(), this.ui.initialize({ onMove: this.handleMove.bind(this), onUndo: this.undo.bind(this), onRedo: this.redo.bind(this), onFlip: this.flip.bind(this), onSubmit: this.submitGuess.bind(this), onFillPrevious: this.fillPreviousCorrect.bind(this), isGameOver: () => this.gameState.isGameOver }), this.setupGlobalFunctions(), this.ui.initializeBoard(this.game), await this.mode.initialize(this); let e = this.settings.notationType || F; this.ui.updateNotationBadge(L[e]) } catch { this.ui.showMaintenanceModal() } } async loadPuzzle() { let e = await this.mode.loadPuzzle(this.api, this.storage); return e && (this.puzzle = e, this.updateCurrentGuess()), e } handleMove(e) { e && e.san !== this.curGuessStack[this.curGuessStack.length - 1] && (this.curGuessStack = []), this.updateCurrentGuess() } submitGuess() { let e = this.game.getHistory(), t = m[this.settings.difficulty]; if (e.length < t) { this.ui.showAlert("Fill up all the moves first!"); return } this.settings.notationType || (this.settings.notationType = F); let s = this.puzzle.getMovesForDifficulty(this.settings.difficulty), o = this.validator.validateGuess(e, s, this.settings.notationType); this.gameState.addGuess(e, o), this.storage.saveGameState(this.gameState), this.storage.saveSettings(this.settings), this.ui.addPreviousGuess(e, o, this.settings.difficulty), this.ui.disableNotationButtons(), this.validator.isWinningResult(o) ? this.mode.handleWin(this) : this.gameState.prevGuesses.length >= 6 ? this.mode.handleLoss(this) : this.resetBoard() } endGame(e) { this.gameState.endGame(), this.storage.saveGameState(this.gameState), this.ui.hideGameElements(); let t = this.puzzle.getName(this.settings.difficulty), s = this.puzzle.getMovesForDifficulty(this.settings.difficulty); this.puzzle.date === "2024-04-01" ? this.ui.showShareModal(!1, this.mode.getDisplayName(), this.gameState.prevResults, s, t, "April Fools!") : this.ui.showShareModal(e, this.mode.getDisplayName(), this.gameState.prevResults, s, t), this.mode.submitResult(this, e) } undo() { let e = this.game.undoMove(); e && (this.curGuessStack.push(e.san), this.ui.updateBoardPosition(), this.updateCurrentGuess()) } redo() { if (this.curGuessStack.length > 0) { let e = this.curGuessStack.pop(); this.game.makeMove(e), this.ui.updateBoardPosition(), this.updateCurrentGuess() } else this.fillPreviousCorrect() } flip() { this.ui.flipBoard() } fillPreviousCorrect() { if (this.gameState.prevResults.length === 0) return; this.curGuessStack = []; let e = this.game.getMoveCount(), t = m[this.settings.difficulty], s = this.puzzle.getMovesForDifficulty(this.settings.difficulty), o = !1; for (let i = e; i < t; i++) { let a = !1; if (this.settings.notationType === "psm") { let l = new Chess; for (let c = 0; c < i; c++)l.move(s[c]); let r = l.move(s[i]); if (!r) continue; let d = r.piece + r.from + r.to; for (let c = 0; c < this.gameState.prevGuesses.length; c++)if (this.gameState.prevResults[c][i] === "g") { let h = this.gameState.prevGuesses[c][i], H = new Chess, W = !0; for (let v = 0; v < i; v++)if (!H.move(this.gameState.prevGuesses[c][v])) { W = !1; break } if (!W) continue; let S = H.move(h); if (!S) continue; if (S.piece + S.from + S.to === d) { let v = this.game.chess.moves({ verbose: !0 }); for (let I of v) if (I.piece + I.from + I.to === d && this.game.makeMove(I.san)) { a = !0, o = !0; break } if (a) break } } } else for (let l = 0; l < this.gameState.prevGuesses.length; l++)if (this.gameState.prevResults[l][i] === "g") { let r = this.gameState.prevGuesses[l][i]; if (this.game.makeMove(r)) { let c = this.game.getHistory(), h = this.validator.validateGuess(c, s.slice(0, c.length), this.settings.notationType); if (h[h.length - 1] === "g") { a = !0, o = !0; break } else this.game.undoMove() } } if (!a) break } o && (this.ui.updateBoardPosition(), this.updateCurrentGuess()) } resetBoard() { this.game.reset(), this.ui.updateBoardPosition(), this.updateCurrentGuess() } updateCurrentGuess() { this.ui.updateCurrentGuess(this.game.getHistory(), this.settings.difficulty) } chooseMode(e) { this.settings.difficulty = e, this.storage.saveSettings(this.settings); let t = m[e]; this.ui.setMaxMoves(t), this.mode.handleModeChosen(this, e), this.updateCurrentGuess() } chooseNotation(e) { this.gameState.prevGuesses.length >= 1 || (this.settings.notationType = e, this.storage.saveSettings(this.settings), this.ui.updateNotationBadge(L[e]), this.ui.hideBubble(), this.ui.hideModal("notationModal")) } createShareText() { return this.shareService.createShareText(this.mode.getDisplayName(), this.puzzle.id, this.settings.difficulty, this.gameState, this.mode.getShareUrl()) } setupGlobalFunctions() { window.submitGuess = () => this.submitGuess(), window.fillPrevCorrect = () => this.fillPreviousCorrect(), window.chooseMode = e => this.chooseMode(e), window.chooseNotation = e => this.chooseNotation(e), window.undo = () => this.undo(), window.flip = () => this.flip(), window.createSharePasta = () => this.shareService.shareToClipboard(this.createShareText(), () => this.ui.showShareAlert()), window.openHelpModal = e => this.ui.showHelpModal(e), window.openNotationHelpModal = () => this.ui.showNotationModal(this.chooseNotation.bind(this), this.gameState.prevGuesses.length === 0), window.closeBubble = () => this.ui.hideBubble(), this.mode.requiresPlayAgain && (window.playAgain = () => this.mode.playAgain(this)) } }; var k = class {
    constructor() { this.displayName = J.DAILY, this.storageSuffix = j.DAILY, this.requiresPlayAgain = !1 } getDisplayName() { return this.displayName } getStorageSuffix() { return this.storageSuffix } getShareUrl() { return "https://jackli.gg/chessle" } async initialize(e) { let t = e.storage.loadDailyDate(), s = await this.loadPuzzle(e.api, e.storage); if (!s) throw new Error("Failed to load puzzle"); if (e.puzzle = s, t !== s.date) e.storage.clearGameData(), e.storage.saveDailyData(s.date), e.ui.showInstructionsModal(this.displayName, e.chooseMode.bind(e)); else if (e.gameState = e.storage.loadGameState(), e.settings.difficulty = e.storage.loadSettings().difficulty, e.gameState.prevGuesses.length === 0) e.ui.showInstructionsModal(this.displayName, e.chooseMode.bind(e)); else { if (e.ui.showAllPreviousGuesses(e.gameState.prevGuesses, e.gameState.prevResults, e.settings.difficulty), e.gameState.isGameOver) { let o = e.gameState.isWin(); e.endGame(o) } else this.handleModeChosen(e, e.settings.difficulty); e.gameState.prevGuesses.length >= 1 && e.ui.disableNotationButtons() } } async loadPuzzle(e, t) { let s = await e.fetchDailyPuzzle(); return t.savePuzzle(s), s } handleModeChosen(e, t) { e.puzzle || (e.puzzle = e.storage.loadPuzzle()); let s = m[t]; e.ui.setMaxMoves(s), e.ui.updateCurrentGuess(e.game.getHistory(), t), localStorage.getItem("chessleNotationType") || e.ui.showBubble() } handleWin(e) { e.storage.save("isWin", !0), e.endGame(!0) } handleLoss(e) { e.storage.save("isWin", !1), e.endGame(!1) } async submitResult(e, t) {
      try {
        let s = { userId: e.settings.userId, prevGuesses: e.gameState.prevGuesses, prevResults: e.gameState.prevResults, notationType: e.settings.notationType, isWin: t, difficulty: e.settings.difficulty, date: e.puzzle.date }; e.settings.legacyUserId && (s.legacyUserId = e.settings.legacyUserId); let o = await e.api.submitResult(s); if (o) {
          let i = `
          <br />
          Today, ${o.percent_correct}% of people got ${G[e.settings.difficulty]} mode correct.
          <br />
          Of the people who got it correct, it took ${o.avg_tries} tries on average.
          <br />
        `; e.ui.updateShareStats(i)
        }
      } catch (s) { console.error("Failed to submit result:", s) }
    }
  }; function te(n) {
    return `
    <link rel="icon" type="image/png" href="static/images/favicon.ico"/>
    <title>${n}</title>
  `} function se(n) {
    let e = n === "Chessle Infinite"; return `
    <div class="container">
      <!-- Instructions Modal -->
      <div class="modal fade" id="instructionsModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" id="instructionsModalInner" role="document">
          <div class="modal-content">
            <div class="modal-header header-p0">
              <h5 class="modal-title" id="instructionsModalTitle"></h5>
            </div>
            <div class="modal-body row justify-content-center modal-instructions">
              <p id="instructionsModalBody"></p>
            </div>
            <div class="row justify-content-center">
              ${e ? `
    <button type="button" class="btn btn-primary btn-lg mode-button play-infinite" onclick="chooseMode('e')">
      Play<br />
    </button>
  `: `
    <button type="button" class="btn btn-primary btn-lg mode-button" onclick="chooseMode('n')">
      Normal Mode<br />
      <p class="mode-desc">(Guess 3 moves for each colour)</p>
    </button>
    <button type="button" class="btn btn-primary btn-lg mode-button" onclick="chooseMode('e')">
      Expert Mode<br />
      <p class="mode-desc">(Guess 5 moves for each colour)</p>
    </button>
  `}
            </div>
          </div>
        </div>
      </div>

      <!-- Help Modal -->
      <div class="modal fade" id="helpModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" id="helpModalInner" role="document">
          <div class="modal-content">
            <div class="modal-header header-p0">
              <h5 class="modal-title" id="helpModalTitle"></h5>
              <button type="button" class="close close-modal-button" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body row justify-content-center modal-instructions">
              <p id="helpModalBody" class="modal-body-text"></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Notation Modal -->
      <div class="modal fade" id="notationModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" id="notationModalInner" role="document">
          <div class="modal-content">
            <div class="modal-header header-p0">
              <h5 class="modal-title" id="notationModalTitle">Matching Modes</h5>
              <button type="button" class="close close-modal-button" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="alert alert-info text-center mb-3" style="font-size: 0.9rem;">
                <i class="fas fa-info-circle"></i> Your choice is locked after submitting your first guess!
              </div>
              
              <div class="notation-comparison-container">
                <div class="row">
                  <!-- Exact Notation Card -->
                  <div class="col-md-6 mb-3">
                    <div class="notation-card h-100">
                      <h5 class="notation-card-title">
                        <i class="fas fa-equals"></i> Exact Notation Matching
                        <span class="badge badge-secondary badge-sm">Default</span>
                      </h5>
                      <p class="notation-card-subtitle">Notation must match exactly</p>
                      
                      <div class="notation-examples">
                        <div class="notation-example">
                          <div class="notation-moves">
                            <span class="move-notation">Nxe5</span>
                            <span class="vs">vs</span>
                            <span class="move-notation">Ne5</span>
                          </div>
                          <div class="notation-result notation-different">
                            <i class="fas fa-times-circle"></i> Different
                          </div>
                        </div>
                        
                        <div class="notation-example">
                          <div class="notation-moves">
                            <span class="move-notation">Qh5+</span>
                            <span class="vs">vs</span>
                            <span class="move-notation">Qh5</span>
                          </div>
                          <div class="notation-result notation-different">
                            <i class="fas fa-times-circle"></i> Different
                          </div>
                        </div>
                        
                        <div class="notation-example">
                          <div class="notation-moves">
                            <div class="text-center">
                              <span class="move-notation">e5</span>
                              <small class="notation-condition d-block">(if white moved from e4\u2192e5)</small>
                            </div>
                            <span class="vs">vs</span>
                            <div class="text-center">
                              <span class="move-notation">e5</span>
                              <small class="notation-condition d-block">(if black moved from e7\u2192e5)</small>
                            </div>
                          </div>
                          <div class="notation-result notation-same">
                            <i class="fas fa-check-circle"></i> Same
                          </div>
                        </div>
                      </div>
                      
                      <button class="btn btn-primary btn-block mt-3" id="chooseEnm" onclick="chooseNotation('enm')">
                        Choose Exact Notation Matching
                      </button>
                    </div>
                  </div>
                  
                  <!-- Piece Square Card -->
                  <div class="col-md-6 mb-3">
                    <div class="notation-card h-100">
                      <h5 class="notation-card-title">
                        <i class="fas fa-chess-knight"></i> Piece Square Matching
                      </h5>
                      <p class="notation-card-subtitle">Same piece type moving from same starting square to same ending square</p>
                      
                      <div class="notation-examples">
                        <div class="notation-example">
                          <div class="notation-moves">
                            <span class="move-notation">Nxe5</span>
                            <span class="vs">vs</span>
                            <span class="move-notation">Ne5</span>
                          </div>
                          <div class="notation-result notation-same">
                            <small class="notation-condition">(if both moved from f3\u2192e5)</small>
                            <i class="fas fa-check-circle"></i> Same
                          </div>
                        </div>
                        
                        <div class="notation-example">
                          <div class="notation-moves">
                            <span class="move-notation">Qh5+</span>
                            <span class="vs">vs</span>
                            <span class="move-notation">Qh5</span>
                          </div>
                          <div class="notation-result notation-same">
                            <small class="notation-condition">(if both moved from d1\u2192h5)</small>
                            <i class="fas fa-check-circle"></i> Same
                          </div>
                        </div>
                        
                        <div class="notation-example">
                          <div class="notation-moves">
                            <div class="text-center">
                              <span class="move-notation">e5</span>
                              <small class="notation-condition d-block">(if white moved from e4\u2192e5)</small>
                            </div>
                            <span class="vs">vs</span>
                            <div class="text-center">
                              <span class="move-notation">e5</span>
                              <small class="notation-condition d-block">(if black moved from e7\u2192e5)</small>
                            </div>
                          </div>
                          <div class="notation-result notation-different">
                            <i class="fas fa-times-circle"></i> Different
                          </div>
                        </div>
                      </div>
                      
                      <button class="btn btn-primary btn-block mt-3" id="choosePsm" onclick="chooseNotation('psm')">
                        Choose Piece Square Matching
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Maintenance Modal -->
      <div class="modal fade" id="maintenanceModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header header-p0">
              <h5 class="modal-title">Maintenance</h5>
            </div>
            <div class="modal-body row justify-content-center modal-instructions">
              <p>Chessle is currently under maintenance. Please check <a href="https://twitter.com/jackli_gg" target="_blank">Twitter</a> \u{1F642}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Game Board -->
      <div class="d-flex justify-content-center align-self-center">
        <div id="myBoard" class="col-sm-8 lock-screen chess-board"></div>
      </div>

      <!-- Game Controls -->
      <div class="row justify-content-center align-self-center row-buttons">
        <button type="button" class="btn btn-danger btn-icon" id="undoButton" onclick='undo()' title="Undo"><i class="fas fa-undo"></i></button>
        <button type="button" class="btn btn-info btn-icon" id="flipButton" onclick='flip()' title="Flip"><i class="fas fa-retweet"></i></button>
        <button type="button" class="btn btn-success row-button" id="fillButton" onclick='fillPrevCorrect()'><i class="fas fa-history"></i> Fill Previously Correct</button>
        <div class="notation-button-wrapper">
          <button class="btn btn-secondary row-button row-button-notation" id="chooseNotationButton" onclick="openNotationHelpModal(); closeBubble();">
            <i class="fa-solid fa-gear"></i> <span id="chooseNotation"></span>
          </button>
          <div class="bubble" id="bubble">
            <span type="button" class="close close-bubble-button" aria-label="Close" onclick="closeBubble()">
              <span aria-hidden="true">&times;</span>
            </span>
            <p class="bubble-text">NEW: Try the different matching types!</p>
          </div>
        </div>
      </div>

      <!-- Guess Areas -->
      <div id="prevGuesses"></div>
      <div class="row justify-content-center align-self-center" id="currentGuess"></div>
      <div class="row justify-content-center align-self-center row-buttons" id="errorArea"></div>

      <!-- Submit -->
      <div id="overlay"></div>
      <div class="row justify-content-center align-self-center row-buttons" id="submit">
        <button class="btn btn-primary row-button" onclick="submitGuess()"><i class="fas fa-check"></i> Submit</button>
      </div>

      <!-- Share Modal -->
      <div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="shareModalTitle"></h5>
              <button type="button" class="close close-modal-button" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body row justify-content-center">
              <p id="shareModalBody" class="share-modal-body"></p>
            </div>
            <div class="modal-footer">
              ${e ? `
    <button type="button" class="btn btn-primary btn-lg play-again" onclick="playAgain()">Play Again</button>
    <div id="alertArea"></div>
    <button type="button" class="btn btn-success btn-lg share" onclick="createSharePasta()">Share</button>
  `: `
    <div id="alertArea"></div>
    <button type="button" class="btn btn-success btn-lg" onclick="createSharePasta()">Share</button>
  `}
            </div>
          </div>
        </div>
      </div>
    </div>
  `} var oe = new k, ie = oe.getDisplayName(); document.getElementById("head").innerHTML += te(ie); document.getElementById("body").innerHTML += se(ie); var re = new A(oe); re.initialize().catch(n => { console.error("Failed to initialize Chessle:", n) });
})();
//# sourceMappingURL=game.min.js.map
